create fname ," test.out" nip dup allot  value #fname
create wbuf ," text file" nip dup allot  value /wbuf
create rbuf /wbuf 5 +  dup allot  value /rbuf

-1 value fd

: test-create
   fname #fname 420 create-file
   dup 0 < if -1 sysexit then
   to fd ;

: test-close
   fd close  0 < if
      ." close failed" cr
      1 sysexit
   then ;

: test-open
   fname #fname 2 open-file  dup 0 < if
      ."  open failed" cr
       1 sysexit
   then
   to fd ;
   
: test-write
   wbuf /wbuf fd write  /wbuf /= if
      ." write failed" cr
      1 sysexit
  then ;

: test-read
   rbuf /rbuf fd read dup 1 < if
      ." read failed" cr
      1 sysexit
   then

   push  wbuf rbuf  pop mem=  0 = if
      ." read contents do not match" cr
      1 sysexit
   then ;

test-create
test-write
test-close
test-open
test-read
test-close
