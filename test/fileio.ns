create fname " test.out" drop
create wbuf " text file" drop
create rbuf wbuf str-len @ 5 +  dup allot  value /rbuf

-1 value fd

: test-create
   fname str>mem 420 create-file
   dup 0 < if -1 sysexit then
   to fd ;

: test-close
   fd close  0 < if
      ." close failed" cr
      1 sysexit
   then ;

: test-open
   fname str>mem 2 0 open-file  dup 0 < if
      ."  open failed" cr
       1 sysexit
   then
   to fd ;
   
: test-write
   wbuf str>mem fd write  wbuf str-len @ ~= if
      ." write failed" cr
      1 sysexit
  then ;

: test-read
   rbuf /rbuf fd read dup 1 < if
      ." read failed" cr
      1 sysexit
   then

   push  wbuf str-data @  rbuf  pop mem=  not if
      ." read contents do not match" cr
      1 sysexit
   then ;

test-create
test-write
test-close
test-open
test-read
test-close
